<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Uncharted admin page</title>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
    <script src="../js/client.js"></script>
    <script type="text/javascript" src="http://w.soundcloud.com/player/api.js"></script>
    <script src="https://connect.soundcloud.com/sdk/sdk-3.0.0.js"></script>
    <script>
        allsongs = [];

        function getAllSongs() {
            $.get('/allsongs', function (data) {
                data = JSON.parse(data);
                data.forEach(function (val, ind) {
                    var song = {};
                    song.song_id = val.song_id;
                    song.id = val.id;
                    song.song_title = val.song_title;
                    song.user_name = val.user_name;
                    song.user_id = val.user_id;
                    song.user_image = val.user_image;
                    song.song_image = val.song_image;
                    song.song_url = val.song_url;
                    song.likes = val.likes;
                    allsongs.push(song);
                });
                populateList();
                randomSong();
                populateInfo();
            });
        }

        function randomSong() {
            randSelect = Math.floor(Math.random() * allsongs.length);
            $('.song-list option:eq(' + randSelect + ')').prop('selected', true)
        }

        function songFilter(song) {
            return eval($('.list-eval').val());
        }

        function populateList() {
            $('.song-list').empty();
            allsongs.forEach(function (val, ind) {
                if (songFilter(val)) {
                    $option = $('<option>');
                    $option.attr('value', ind);
                    $option.text(val.user_name + ' - ' + val.song_title);
                    $('.song-list').append($option);
                }
            });
            $('.counter').text($('option').length + ' / ' + allsongs.length);
        }

        function populateInfo() {
            currentSong = allsongs[$('.song-list').val()];
            $('.info-cont').empty();
            for (key in currentSong) {
                $div = $('<div>');
                $div.text(key + ': ' + currentSong[key]);
                $('.info-cont').append($div);
            }
            setCurrentSong();
        }

        function setCurrentSong() {
            SC.get("/tracks/" + allsongs[$('.song-list').val()].song_id).then(function (sound) {
                var url = sound.stream_url + "?client_id=27bcac07db1cde6ee2ff5f3ad8d79969";
                $("#audio-player").attr("src", url);
                $("#audio-player").play();
            });
        }

        $(function () {
            SC.initialize({
                client_id: '27bcac07db1cde6ee2ff5f3ad8d79969'
            });

            getAllSongs();

            $('.song-list').on('change', populateInfo);

            $('#addLike').on('click', function () {
                $.post("/likesong", {'song-id': allsongs[$('.song-list').val()].song_id});
            });

            $('#removeSong').on('click', function () {
                $.post('/removesong', {'song-id': allsongs[$('.song-list').val()].song_id});
            });

            $('.filter-list').on('click', populateList);

            $('#playsong').on('click', $('#audio-player').play);
            $('#pausesong').on('click', $('#audio-player').pause);
        });
    </script>
</head>

<body>
    <select class="song-list"></select>
    <input type="text" class="list-eval" value="true">

    <input type="button" class="filter-list" value="Filter">
    <span class="counter"></span>

    <div class="info-cont"></div>

    <button id="removeSong">Remove Song</button>
    <button id="addLike">Add Like</button><br>

    <!--
    <button id="playsong">Play</button>
    <button id="pausesong">Pause</button> -->
    <br>
    <audio controls id="audio-player" src=""></audio>
</body>

</html>